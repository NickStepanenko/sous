<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <link href="bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="bower_components/bootstrap/dist/css/shop-item.css" rel="stylesheet">

    <script type="text/javascript" src="bower_components/jquery/dist/jquery.js"></script>
    <script type="text/javascript" src="bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

    <script type="text/javascript" language="javascript" src="patches.json"></script>
    <script>
        var currentState = 1;

        var data = JSON.parse(JSON.stringify(jsonObject));
        var percentagePart = 100/(data.commits.length-1);
        var currentPercentage = percentagePart;

        function applyCommitForward() {
            $("#commitsWindow").append("\<li id=\"comment" + (currentState + 1) + "\" class=\"list-group-item list-group-item-info\"\>" +
                    data.commits[currentState+1].comment
                    + "\</li\>"
            );
            currentPercentage += percentagePart;
            $("#progressBar").css("width", currentPercentage + "%");
            console.log($("#progressBar").width());
            currentState++;

            if(currentState == data.commits.length - 1) {
                $("#commitsSwitcher-next").prop('disabled', true);
            }

            $("#commitsSwitcher-prev").prop('disabled', false);
        }

        function applyCommitBack() {
            $("li[id=comment" + currentState + "]").remove();

            currentPercentage -= percentagePart;
            $("#progressBar").css("width", currentPercentage + "%");
            currentState--;

            if(currentState == 1) {
                $("#commitsSwitcher-prev").prop('disabled', true);
            }

            $("#commitsSwitcher-next").prop('disabled', false);
        }

        function changeState(n_state) {
            if(n_state > currentState) {
                while(n_state > currentState) applyCommitForward();
            } else {
                while(n_state < currentState) applyCommitBack();
            }
        }

        (function ($) {$(document).ready(function() {
            $("#header-name").append(data.commits[0].comment);
            $("#progressBar").css("width", currentPercentage + "%");

            var files = data.commits[1].content;

            var count = 1;
            while(count < data.commits.length) {
                $("#listOfSlides").append("\<li id=\"slide" + count + "\">\<a href=\"#\"\>Слайд " + count + "\</a\>\</li\>");
                count++;
            }

            count = 0;
            while(count<files.length) {
                var code = "";
                var count_j = 0;

                $("#filesSwitcher").append(
                        "\<li\>\<a data-toggle=\"tab\" href=\"#file" + count + "\"\>" +
                        "\<span class=\"glyphicon glyphicon-file\" aria-hidden=\"true\"\>\</span\> " +
                        files[count].filename
                        + "\</a\>\</li\>"
                );

                while(count_j < files[count].changes.length) {
                    code += files[count].changes[count_j].changesCode;
                    count_j++;
                }

                $("#filesContent").append(
                        "\<div  id=\"file" + count + "\" class=\"tab-pane fade in active\"\>\<pre\>" +
                        code +
                        "\</pre\>\</div\>"
                );

                count++;
            }

            $("#commitsWindow").append("\<li id=\"comment1\" class=\"list-group-item list-group-item-info\"\>" +
                    data.commits[1].comment
                    + "\</li\>"
            );

            $("#commitsSwitcher-prev").prop('disabled', true);

            $('#commitsSwitcher-prev').on('click', function() {
                if(currentState > 0) {
                    changeState(currentState - 1);
                }
            });

            $("#commitsSwitcher-next").on('click', function() {
                if(!$("#commitsSwitcher-next").prop('disabled')) {
                    changeState(currentState + 1);
                }
            });

            $(".dropdown-menu").click(function(event) {
                var clickedElemId = event.target.parentNode.id;
                changeState(clickedElemId.slice(5));
            });
        });})(jQuery);
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                </button>
                <a id="header-name" class="navbar-brand"></a>
            </div>
        </div>
        <!-- /.container -->
    </nav>

    <div id="content" class="container">
        <div class="row">
            <div class="col-md-4">
                <div id="commitsSwitcher" style="padding-bottom: 10px">
                    <div class="btn-group" role="group" aria-label="..." align="left" style="position: relative">
                        <button id="commitsSwitcher-prev" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span></button>
                        <div class="btn-group">
                            <button type="button" class="btn btn-default">Слайды</button>
                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                <span class="caret"></span>
                            </button>
                            <ul id="listOfSlides" class="dropdown-menu" role="menu"></ul>
                        </div>
                        <button id="commitsSwitcher-next" type="button" class="btn btn-primary"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span></button>
                    </div>
                </div>
                <ul id="commitsWindow" class="list-group"></ul>
            </div>

            <div class="col-md-8">
                <div class="container">
                    <ul id="filesSwitcher" class="nav nav-tabs"></ul>
                    <div id="filesContent" class="tab-content">
                        <div id="home" class="tab-pane fade in active">
                            <h3>Нажмите на вкладку с названием файла, чтобы показать содержимое.</h3>
                        </div>
                </div>
            </div>
        </div>
    </div>


    <div class="navbar-fixed-bottom row-fluid">
        <div class="navbar-inner">
            <div id="progressBar" class="progress-bar progress-bar-striped" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100"
                 style="padding: 5px;">
            </div>
        </div>
    </div>
</body>
</html>